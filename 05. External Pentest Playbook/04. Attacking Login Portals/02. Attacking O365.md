### Password Spraying O365

An important approach. Due to Active Directory tie-in. A lot of companies make use of O365.

What does that mean... If you find a valid login in, that login will prob work with VPNs and other login in portals as they are all tied in together with AD.

#### BIG NOTE EARLY - You must know the account lock out policy. Ask during scoping! This is important! We do not want to be locking people out.

Basic methodology:

- Take list of emails
- Go to O365 login portal
- Look for error messages to confirm valid accounts
- spray with most likely password.
- Get valid logins

#### Tools change. Look for a O365 spraying tool.
O365 is getting better at preventing attacks all the time. Tools change.
O365 is now better at detecting sprays, blocking them or giving false notifications and alerts.
Trevorspray is good. 
https://github.com/blacklanternsecurity/TREVORspray

```
./trevorspray.py -e /opt/trevorspray/log/<emaillist>.txt --passwords '<password>' --delay <delay in seconds (start 15)> --no-current-ip --ssh <ip1><ip2><ip3><ip n> -k <pemfile>.pem
```

give trevorspray a list of emails.
give it a password to try: Winter21! location EG:/opt/trevorspray/log/<emaillist>.txt
set a delay. too short you risk IPs being blocked.
set no current IP so your machine IP isnt used.
set ssh into a list of proxy machine IPs. (set up about 10) this increase the time between each IP's request.
Use AWS FREE machines to establish machines to proxy through. (Steps below)

Output - anything other than invalid login, should be manually confirmed by going to the O365 portal and logging in. Some returns "incorrect state, blocked due to, etc" are still valid logins.

Note - if you get multiple account lock out notifications. STOP.  Do not cause adverse affects on client. Give it some time, maybe 1 hour and slow it down.

#### AWS proxy machine set up.

- Sign up for AWS
- Go to AWS management console
- Launch a virtual machine
- search ubuntu
- Select a "free tier eligible" 64bit (x86) AMI
- Select a free tier eligible instance type (prob t2.micro)
- review and launch
- leave everything as default. Click launch.
- create a new key pair
- give it a name <name> and download
- launch instance
- view instances
- actions > image and template > launch more like this
- Launch > use same key pair, Ack it works, launch
- Repeat X times.
- then take the public IP address and use that in the trevorspray.
- NOTE - you need to SSH into the machines first and accept the finger prints, otherwise the tool wont work.
- I need to automate this.

The goal of O365 spraying to to get in. As O365 has a lot of tools where data is stored that may contain sensitive information we can use down the line. 
Emails
one drive
notes
SharePoint
teams